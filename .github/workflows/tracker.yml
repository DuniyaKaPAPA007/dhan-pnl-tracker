name: Dhan P&L Tracker

on:
  schedule:
    # Runs Mon-Fri at 9:15 AM, 11:00 AM, 1:00 PM IST
    # GitHub uses UTC, so IST - 5:30 = UTC times
    - cron: '45 3 * * 1-5'   # 9:15 AM IST
    - cron: '30 5 * * 1-5'   # 11:00 AM IST
    - cron: '30 7 * * 1-5'   # 1:00 PM IST
  
  workflow_dispatch:  # Manual run button

jobs:
  track-portfolio:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
      
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      
      - name: Install dependencies
        run: |
          pip install dhanhq yfinance pandas
      
      - name: Run tracker
        env:
          DHAN_CLIENT_ID: ${{ secrets.DHAN_CLIENT_ID }}
          DHAN_ACCESS_TOKEN: ${{ secrets.DHAN_ACCESS_TOKEN }}
          STOP_LOSS_LIMIT: ${{ secrets.STOP_LOSS_LIMIT }}
        run: |
          python dhan_tracker.py
      
      - name: Upload logs (optional)
        if: always()
        uses: actions/upload-artifact@v3
        with:
          name: tracker-logs
          path: |
            *.log
            *.txt
